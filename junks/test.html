<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Add Bachelor Program Modal | Dean's Portal</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#6366f1', // indigo-500
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        },
                        secondary: {
                            DEFAULT: '#8b5cf6', // violet-500
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        }
                    }
                }
            }
        }
    </script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <!-- AOS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet"/>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>

    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #ec4899;
        }

        html, body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: #e2e8f0;
            min-height: 100vh;
        }

        /* Modal transitions */
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: all 220ms ease-out;
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.95);
            transition: all 180ms ease-in;
        }
        .backdrop-enter {
            opacity: 0;
        }
        .backdrop-enter-active {
            opacity: 1;
            transition: opacity 200ms ease-out;
        }
        .backdrop-exit {
            opacity: 1;
        }
        .backdrop-exit-active {
            opacity: 0;
            transition: opacity 160ms ease-in;
        }

        /* Glass card effect */
        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(99, 102, 241, 0.15);
        }

        /* Bachelor card styling */
        .bachelor-card {
            perspective: 1000px;
            transform-style: preserve-3d;
            transition: all 0.5s ease;
        }
        .bachelor-card:hover {
            transform: translateY(-6px) scale(1.01);
        }
        .bachelor-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .bachelor-card:hover .bachelor-card-inner {
            transform: rotateY(5deg) rotateX(5deg);
        }
        .bachelor-image {
            transform: rotate(-5deg);
            transition: all 0.5s ease;
        }
        .bachelor-card:hover .bachelor-image {
            transform: rotate(0deg) scale(1.05);
        }

        /* Gradient text */
        .gradient-text {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        /* Input styling */
        .form-input {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Floating animation */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .floating {
            animation: float 6s ease-in-out infinite;
        }

        /* Pulse animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Success message */
        .success-message {
            transform: translateY(100%);
            transition: transform 0.4s ease-out;
        }
        .success-message.show {
            transform: translateY(0);
        }

        /* Rotating gears */
        .gear-icon {
            transition: transform 0.6s ease;
        }
        .rotate {
            transform: rotate(360deg);
        }

        /* Button hover lift */
        .hover-lift {
            transition: transform 180ms ease, box-shadow 180ms ease;
        }
        .hover-lift:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.25);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">
    <!-- Add Bachelor Button (opens modal) -->
    <button id="openAddBachelorModal"
            class="group relative inline-flex items-center gap-3 px-6 py-3.5 rounded-xl text-white font-semibold bg-gradient-to-br from-primary to-secondary hover:from-primary-600 hover:to-secondary-600 focus:outline-none focus:ring-4 focus:ring-primary/30 transition-all duration-200 shadow-lg hover:shadow-primary/30 hover-lift">
        <span class="absolute inset-0 rounded-xl bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-200"></span>
        <i data-feather="plus-circle" class="w-5 h-5"></i>
        <span>Add Bachelor</span>
    </button>

    <!-- Modal Backdrop -->
    <div id="modalBackdrop"
         class="fixed inset-0 z-40 bg-black/70 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-200"></div>

    <!-- Modal -->
    <div id="addBachelorModal"
         class="fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 opacity-0 pointer-events-none transition-all duration-200">
        <!-- Modal Panel -->
        <div class="relative w-full max-w-7xl max-h-[92vh] overflow-hidden">
            <div class="glass-card rounded-2xl shadow-2xl border border-white/10 modal-enter modal-enter-active"
                 id="modalPanel">
                <!-- Header -->
                <div class="px-6 py-5 border-b border-white/10 flex items-center justify-between">
                    <div>
                        <h1 class="text-xl sm:text-2xl font-bold text-white">
                            <span class="gradient-text">Add New Bachelor Program</span>
                        </h1>
                        <p class="text-gray-400 text-sm">Register new undergraduate programs for your department</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="closeModalBtn"
                                class="glass-card p-2 rounded-lg hover:bg-primary/10 transition-all"
                                title="Close">
                            <i data-feather="x" class="w-5 h-5 text-gray-300"></i>
                        </button>
                    </div>
                </div>

                <!-- Scrollable Content -->
                <div class="overflow-y-auto max-h-[calc(92vh-72px)]">
                    <main class="p-6">
                        <!-- Two Column Layout -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Form Section -->
                            <div class="lg:col-span-2">
                                <div class="glass-card rounded-2xl p-6" data-aos="fade-right">
                                    <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                        <i data-feather="plus-circle" class="text-primary-400"></i>
                                        Program Details
                                    </h2>

                                    <form id="bachelorForm" class="space-y-5">
                                        <!-- Program Name -->
                                        <div>
                                            <label for="programName" class="block text-sm font-medium text-gray-300 mb-2">Program Name</label>
                                            <input
                                                type="text"
                                                id="programName"
                                                class="w-full form-input px-4 py-3 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500"
                                                placeholder="Bachelor of Medicine and Bachelor of Surgery (MBBS)"
                                                required
                                            />
                                        </div>

                                        <!-- Program Code -->
                                        <div>
                                            <label for="programCode" class="block text-sm font-medium text-gray-300 mb-2">Program Code</label>
                                            <input
                                                type="text"
                                                id="programCode"
                                                class="w-full form-input px-4 py-3 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500"
                                                placeholder="MBBS"
                                                required
                                            />
                                        </div>

                                        <!-- Description -->
                                        <div>
                                            <label for="programDescription" class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                                            <textarea
                                                id="programDescription"
                                                rows="4"
                                                class="w-full form-input px-4 py-3 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500"
                                                placeholder="A comprehensive medical program that prepares students..."
                                            ></textarea>
                                        </div>

                                        <!-- Duration and Credits -->
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div>
                                                <label for="programDuration" class="block text-sm font-medium text-gray-300 mb-2">Duration (Years)</label>
                                                <select
                                                    id="programDuration"
                                                    class="w-full form-input px-4 py-3 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500"
                                                    required
                                                >
                                                    <option value="">Select duration</option>
                                                    <option value="1">1 Year</option>
                                                    <option value="2">2 Years</option>
                                                    <option value="3">3 Years</option>
                                                    <option value="4" selected>4 Years</option>
                                                    <option value="5">5 Years</option>
                                                    <option value="6">6 Years</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="programCredits" class="block text-sm font-medium text-gray-300 mb-2">Total Credits</label>
                                                <input
                                                    type="number"
                                                    id="programCredits"
                                                    class="w-full form-input px-4 py-3 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500"
                                                    placeholder="120"
                                                    value="120"
                                                    required
                                                />
                                            </div>
                                        </div>

                                        <!-- Specializations -->
                                        <div>
                                            <label for="programSpecializations" class="block text-sm font-medium text-gray-300 mb-2">Specializations (Optional)</label>
                                            <div id="specializationsContainer" class="space-y-2">
                                                <!-- Specializations will be added here -->
                                            </div>
                                            <button
                                                type="button"
                                                id="addSpecialization"
                                                class="mt-2 text-sm text-primary-400 hover:text-primary-300 flex items-center gap-1"
                                            >
                                                <i data-feather="plus" class="w-4 h-4"></i>
                                                Add Specialization
                                            </button>
                                        </div>

                                        <!-- Image URL -->
                                        <div>
                                            <label for="programImage" class="block text-sm font-medium text-gray-300 mb-2">Program Image (URL)</label>
                                            <div class="flex items-center gap-2">
                                                <input
                                                    type="text"
                                                    id="programImage"
                                                    class="flex-1 form-input px-4 py-3 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500"
                                                    placeholder="https://example.com/image.jpg"
                                                    value="http://static.photos/technology/640x360"
                                                />
                                                <button
                                                    type="button"
                                                    id="randomImage"
                                                    class="glass-card px-3 py-3 rounded-lg hover:bg-primary-500/10 transition-all"
                                                    title="Random Image"
                                                >
                                                    <i data-feather="shuffle" class="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Submit Button -->
                                        <div class="pt-2">
                                            <button
                                                type="submit"
                                                id="submitButton"
                                                class="w-full flex justify-center items-center gap-2 py-3.5 px-6 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-gradient-to-r from-primary-500 to-secondary-500 hover:from-primary-600 hover:to-secondary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200"
                                            >
                                                <i data-feather="save" class="w-5 h-5"></i>
                                                Register Program
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- Preview Section -->
                            <div class="lg:col-span-1">
                                <div class="sticky top-0 space-y-4">
                                    <!-- Program Preview -->
                                    <div class="glass-card rounded-2xl p-5" data-aos="fade-left">
                                        <h2 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                                            <i data-feather="eye" class="text-primary-400"></i>
                                            Program Preview
                                        </h2>

                                        <p class="text-gray-400 text-sm mb-4">This is how your program will appear to students</p>

                                        <div class="bachelor-card">
                                            <div class="bachelor-card-inner glass-card rounded-xl overflow-hidden border border-slate-700/50 hover:border-primary-400/30 transition-all">
                                                <!-- Program Image -->
                                                <div class="relative h-36 sm:h-40 overflow-hidden">
                                                    <div class="absolute inset-0 bg-gradient-to-br from-primary-500/20 to-secondary-500/20 z-10"></div>
                                                    <img
                                                        src="http://static.photos/technology/640x360"
                                                        alt="Program Preview"
                                                        id="previewImage"
                                                        class="bachelor-image w-full h-full object-cover"
                                                    />
                                                </div>

                                                <!-- Program Content -->
                                                <div class="p-5">
                                                    <div class="flex justify-between items-start mb-2">
                                                        <h3 id="previewName" class="text-lg sm:text-xl font-bold text-white">New Program</h3>
                                                        <span id="previewCode" class="px-2 py-1 bg-primary-500/20 text-primary-300 rounded-full text-xs font-medium">CODE</span>
                                                    </div>

                                                    <p id="previewDuration" class="text-sm text-gray-400 mb-3">Duration: 4 Years</p>

                                                    <p id="previewDescription" class="text-sm text-gray-300 line-clamp-3 mb-4">
                                                        Program description will appear here...
                                                    </p>

                                                    <div class="flex flex-wrap gap-2" id="previewSpecializations">
                                                        <span class="px-2 py-1 bg-slate-800/50 text-slate-300 rounded-full text-xs">General</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Tips Section -->
                                    <div class="glass-card rounded-2xl p-5" data-aos="fade-left" data-aos-delay="100">
                                        <h2 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                                            <i data-feather="info" class="text-emerald-400"></i>
                                            Tips for Adding Programs
                                        </h2>

                                        <ul class="space-y-2.5 text-sm text-gray-400">
                                            <li class="flex items-start gap-2">
                                                <i data-feather="check-circle" class="w-4 h-4 text-emerald-400 mt-0.5 flex-shrink-0"></i>
                                                <span>Use clear and descriptive program names that students will recognize</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <i data-feather="check-circle" class="w-4 h-4 text-emerald-400 mt-0.5 flex-shrink-0"></i>
                                                <span>Standard program codes help with administration and reporting</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <i data-feather="check-circle" class="w-4 h-4 text-emerald-400 mt-0.5 flex-shrink-0"></i>
                                                <span>Highlight unique aspects of your program in the description</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <i data-feather="check-circle" class="w-4 h-4 text-emerald-400 mt-0.5 flex-shrink-0"></i>
                                                <span>Add specializations to show different tracks within your program</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-[60] opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="glass-card rounded-2xl p-8 max-w-md w-full mx-4 transform transition-all duration-500 scale-90">
            <div class="text-center">
                <div class="w-20 h-20 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i data-feather="check-circle" class="w-10 h-10 text-emerald-400"></i>
                </div>

                <h3 class="text-2xl font-bold text-white mb-2">Program Added Successfully!</h3>
                <p class="text-gray-400 mb-6">The new bachelor program has been registered in your department.</p>

                <div class="flex gap-4 justify-center">
                    <button
                        id="addAnother"
                        class="px-6 py-3 rounded-lg flex items-center gap-2 text-white bg-gradient-to-r from-primary-500 to-secondary-500 hover:from-primary-600 hover:to-secondary-600 transition-all"
                    >
                        <i data-feather="plus"></i>
                        Add Another
                    </button>
                    <button
                        id="viewPrograms"
                        class="px-6 py-3 rounded-lg flex items-center gap-2 text-white bg-slate-700 hover:bg-slate-600 transition-all"
                    >
                        <i data-feather="list"></i>
                        View Programs
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== Modal Controls ==========
        const openBtn = document.getElementById('openAddBachelorModal');
        const modalBackdrop = document.getElementById('modalBackdrop');
        const addBachelorModal = document.getElementById('addBachelorModal');
        const modalPanel = document.getElementById('modalPanel');
        const closeModalBtn = document.getElementById('closeModalBtn');

        function openModal() {
            modalBackdrop.classList.remove('opacity-0', 'pointer-events-none');
            modalBackdrop.classList.add('opacity-100');

            addBachelorModal.classList.remove('opacity-0', 'pointer-events-none');
            addBachelorModal.classList.add('opacity-100');

            // Animate panel
            modalPanel.classList.remove('modal-enter', 'modal-enter-active');
            void modalPanel.offsetWidth; // reflow
            modalPanel.classList.add('modal-enter', 'modal-enter-active');

            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            // Animate out
            modalPanel.classList.remove('modal-enter', 'modal-enter-active');
            modalPanel.classList.add('modal-exit', 'modal-exit-active');

            modalBackdrop.classList.remove('backdrop-enter', 'backdrop-enter-active');
            modalBackdrop.classList.add('backdrop-exit', 'backdrop-exit-active');

            addBachelorModal.classList.add('pointer-events-none');

            setTimeout(() => {
                modalBackdrop.classList.add('opacity-0');
                modalBackdrop.classList.remove('opacity-100', 'backdrop-exit', 'backdrop-exit-active');

                addBachelorModal.classList.add('opacity-0');
                addBachelorModal.classList.remove('opacity-100');

                modalPanel.classList.remove('modal-exit', 'modal-exit-active');

                document.body.style.overflow = '';
            }, 180);
        }

        openBtn.addEventListener('click', openModal);
        closeModalBtn.addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', closeModal);
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // ========== App Logic ==========
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCPV_mXojZBR-Dew8RuZSi9jv9X6rc_D90",
            authDomain: "mentora-71f5c.firebaseapp.com",
            projectId: "mentora-71f5c",
            storageBucket: "mentora-71f5c.appspot.com",
            messagingSenderId: "16685388211",
            appId: "1:16685388211:web:7eed812660439dec7b3bc6",
            measurementId: "G-BL98PXGK2G"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // DOM Elements
        const bachelorForm = document.getElementById('bachelorForm');
        const submitButton = document.getElementById('submitButton');
        const addSpecialization = document.getElementById('addSpecialization');
        const specializationsContainer = document.getElementById('specializationsContainer');
        const randomImage = document.getElementById('randomImage');
        const successModal = document.getElementById('successModal');
        const addAnother = document.getElementById('addAnother');
        const viewPrograms = document.getElementById('viewPrograms');

        // Preview Elements
        const previewName = document.getElementById('previewName');
        const previewCode = document.getElementById('previewCode');
        const previewDescription = document.getElementById('previewDescription');
        const previewDuration = document.getElementById('previewDuration');
        const previewImage = document.getElementById('previewImage');
        const previewSpecializations = document.getElementById('previewSpecializations');

        // Categories for random images
        const imageCategories = [
            'technology', 'education', 'medical', 'science',
            'finance', 'architecture', 'laboratory', 'workspace'
        ];

        // Form inputs
        const programName = document.getElementById('programName');
        const programCode = document.getElementById('programCode');
        const programDescription = document.getElementById('programDescription');
        const programDuration = document.getElementById('programDuration');
        const programCredits = document.getElementById('programCredits');
        const programImage = document.getElementById('programImage');

        // Add specialization
        addSpecialization.addEventListener('click', () => {
            const div = document.createElement('div');
            div.className = 'flex items-center gap-2';
            div.innerHTML = `
                <input
                    type="text"
                    class="flex-1 form-input px-4 py-2 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500"
                    placeholder="Specialization name"
                >
                <button type="button" class="text-red-400 hover:text-red-300">
                    <i data-feather="trash-2" class="w-4 h-4"></i>
                </button>
            `;

            // Add delete functionality
            const deleteBtn = div.querySelector('button');
            deleteBtn.addEventListener('click', () => {
                div.remove();
                updatePreviewSpecializations();
            });

            // Add input event
            const input = div.querySelector('input');
            input.addEventListener('input', updatePreviewSpecializations);

            specializationsContainer.appendChild(div);
            feather.replace();
            updatePreviewSpecializations();
        });

        // Update preview specializations
        function updatePreviewSpecializations() {
            previewSpecializations.innerHTML = '';

            const inputs = specializationsContainer.querySelectorAll('input');
            if (inputs.length === 0) {
                previewSpecializations.innerHTML = '<span class="px-2 py-1 bg-slate-800/50 text-slate-300 rounded-full text-xs">General</span>';
                return;
            }

            inputs.forEach(input => {
                if (input.value.trim()) {
                    const span = document.createElement('span');
                    span.className = 'px-2 py-1 bg-slate-800/50 text-slate-300 rounded-full text-xs';
                    span.textContent = input.value.trim();
                    previewSpecializations.appendChild(span);
                }
            });

            if (previewSpecializations.children.length === 0) {
                previewSpecializations.innerHTML = '<span class="px-2 py-1 bg-slate-800/50 text-slate-300 rounded-full text-xs">General</span>';
            }
        }

        // Get random image
        randomImage.addEventListener('click', () => {
            const category = imageCategories[Math.floor(Math.random() * imageCategories.length)];
            const width = 640;
            const height = 360;
            const seed = Math.floor(Math.random() * 1000);

            const imageUrl = `http://static.photos/${category}/${width}x${height}/${seed}`;
            programImage.value = imageUrl;
            previewImage.src = imageUrl;
        });

        // Update preview on input changes
        programName.addEventListener('input', () => {
            previewName.textContent = programName.value || 'New Program';
        });

        programCode.addEventListener('input', () => {
            previewCode.textContent = programCode.value.toUpperCase() || 'CODE';
        });

        programDescription.addEventListener('input', () => {
            previewDescription.textContent = programDescription.value || 'Program description will appear here...';
        });

        programDuration.addEventListener('change', () => {
            const years = programDuration.value || '4';
            previewDuration.textContent = `Duration: ${years} Year${years === '1' ? '' : 's'}`;
        });

        programImage.addEventListener('input', () => {
            if (programImage.value) {
                previewImage.src = programImage.value;
            }
        });

        // Form submission
        bachelorForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Get current department ID from localStorage
            const deptId = localStorage.getItem('currentDeptId');
            if (!deptId) {
                alert('Department not found. Please login again.');
                window.location.href = 'index.html';
                return;
            }

            // Show loading state
            const submitText = submitButton.innerHTML;
            submitButton.innerHTML = '<i data-feather="loader" class="animate-spin w-5 h-5"></i> Registering...';
            submitButton.disabled = true;
            feather.replace();

            try {
                // Get specializations
                const specializations = [];
                const inputs = specializationsContainer.querySelectorAll('input');
                inputs.forEach(input => {
                    if (input.value.trim()) {
                        specializations.push(input.value.trim());
                    }
                });

                // Get program data
                const programData = {
                    name: programName.value.trim(),
                    code: programCode.value.trim().toUpperCase(),
                    description: programDescription.value.trim(),
                    duration: parseInt(programDuration.value),
                    credits: parseInt(programCredits.value),
                    imageUrl: programImage.value.trim(),
                    specializations: specializations.length ? specializations : ['General'],
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Add program to Firestore
                await db.collection('departments').doc(deptId).collection('programs').add(programData);

                // Show success modal
                successModal.classList.remove('opacity-0', 'pointer-events-none');
                successModal.querySelector('div').classList.remove('scale-90');

            } catch (error) {
                console.error("Error adding program: ", error);
                alert("Failed to add program: " + error.message);
            } finally {
                // Reset button
                submitButton.innerHTML = submitText;
                submitButton.disabled = false;
                feather.replace();
            }
        });

        // Success modal buttons
        addAnother.addEventListener('click', () => {
            // Close modal
            successModal.classList.add('opacity-0', 'pointer-events-none');
            successModal.querySelector('div').classList.add('scale-90');

            // Reset form
            bachelorForm.reset();
            specializationsContainer.innerHTML = '';
            updatePreviewSpecializations();

            // Scroll to top of modal content
            const scrollContent = addBachelorModal.querySelector('.overflow-y-auto');
            scrollContent.scrollTo({ top: 0, behavior: 'smooth' });
        });

        viewPrograms.addEventListener('click', () => {
            window.location.href = 'programs.html';
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            AOS.init({
                duration: 600,
                easing: 'ease-out-quad',
                once: true
            });

            // Check authentication
            auth.onAuthStateChanged(user => {
                if (!user) {
                    window.location.href = 'index.html';
                }
            });

            feather.replace();
        });
    </script>
<script src="https://huggingface.co/deepsite/deepsite-badge.js"></script>
</body>
</html>